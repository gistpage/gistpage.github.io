<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>åº”ç”¨é…ç½®ç®¡ç†å¹³å°</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>âš™ï¸</text></svg>">
  <style>
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
      margin: 0; 
      padding: 0; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #667eea 100%); 
      min-height: 100vh; 
      position: relative;
    }
    
    /* ç™»å½•é¡µé¢éšè—æ»šåŠ¨æ¡ï¼Œç®¡ç†é¡µé¢å…è®¸æ»šåŠ¨ */
    html, body {
      height: 100%;
    }
    /* ç™»å½•é¡µé¢éšè—æ»šåŠ¨æ¡ */
    #loginPage::-webkit-scrollbar {
      display: none;
    }
    #loginPage {
      -ms-overflow-style: none;
      scrollbar-width: none;
      overflow: hidden;
    }
    
    /* ç®¡ç†é¡µé¢çš„ç¾åŒ–æ»šåŠ¨æ¡ */
    #editPage .admin-content {
      scrollbar-width: thin;
      scrollbar-color: rgba(102, 126, 234, 0.3) transparent;
    }
    #editPage .admin-content::-webkit-scrollbar {
      width: 6px;
    }
    #editPage .admin-content::-webkit-scrollbar-track {
      background: transparent;
      border-radius: 3px;
    }
    #editPage .admin-content::-webkit-scrollbar-thumb {
      background: rgba(102, 126, 234, 0.3);
      border-radius: 3px;
      min-height: 20px;
    }
    #editPage .admin-content::-webkit-scrollbar-thumb:hover {
      background: rgba(102, 126, 234, 0.5);
    }
    #editPage .admin-content::-webkit-scrollbar-corner {
      background: transparent;
    }
    body::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(ellipse at center, rgba(255,255,255,0.1) 0%, transparent 70%);
      pointer-events: none;
    }
    body::after {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent, rgba(255,255,255,0.03), transparent);
      animation: backgroundMove 15s ease-in-out infinite;
      pointer-events: none;
    }
    @keyframes backgroundMove {
      0%, 100% { transform: translateX(-100%) translateY(-100%) rotate(0deg); }
      50% { transform: translateX(0%) translateY(0%) rotate(180deg); }
    }
    .login-container { 
      max-width: 420px; 
      margin: 0 auto; 
      padding: 1.2em; 
      height: 100vh; 
      display: flex; 
      flex-direction: column; 
      justify-content: center; 
      overflow: hidden; 
      box-sizing: border-box;
    }
    .admin-container { 
      max-width: 1200px; 
      margin: 0 auto; 
      background: #f8fafc; 
      min-height: 100vh; 
      display: flex; 
      flex-direction: column; 
      padding-bottom: 0;
    }
    .login-card { 
      background: rgba(255, 255, 255, 0.95); 
      backdrop-filter: blur(15px);
      border-radius: 16px; 
      box-shadow: 0 30px 60px rgba(0,0,0,0.12), 0 10px 20px rgba(0,0,0,0.08); 
      padding: 1.8em 2em; 
      text-align: center; 
      max-height: 95vh; 
      border: 1px solid rgba(255,255,255,0.3);
      position: relative;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .admin-header { background: #fff; border-bottom: 1px solid #e2e8f0; padding: 1em 2em; flex-shrink: 0; }
    .admin-content { padding: 1em 2em 1.5em 2em; flex: 1; overflow-y: auto; scroll-behavior: smooth; }
    .field { margin-bottom: 0.8em; }
    .field:last-of-type { margin-bottom: 1em; }
    label { 
      display: block; 
      margin-bottom: 0.5em; 
      font-weight: 600; 
      color: #374151; 
      font-size: 0.9em; 
      text-align: left;
    }
    input { 
      width: 100%; 
      padding: 0.7em 1em; 
      font-size: 1em; 
      border-radius: 10px; 
      border: 2px solid #e5e7eb; 
      box-sizing: border-box; 
      transition: all 0.3s ease; 
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(5px);
    }
    input:focus { 
      outline: none; 
      border-color: #667eea; 
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1); 
      background: rgba(255, 255, 255, 1);
      transform: translateY(-1px);
    }
    input::placeholder {
      color: #9ca3af;
      font-size: 0.95em;
    }
    .login-btn { 
      width: 100%; 
      padding: 0.9em 1.2em; 
      font-size: 1.05em; 
      border-radius: 10px; 
      border: none; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
      color: #fff; 
      cursor: pointer; 
      font-weight: 600; 
      transition: all 0.3s ease;
      margin-top: 0.3em;
      position: relative;
      overflow: hidden;
    }
    .login-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }
    .login-btn:hover::before {
      left: 100%;
    }
    .login-btn:hover { 
      transform: translateY(-2px); 
      box-shadow: 0 15px 30px rgba(102, 126, 234, 0.4);
    }
    .login-btn:active {
      transform: translateY(0);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
    }
    .login-btn:disabled { 
      background: #9ca3af; 
      cursor: not-allowed; 
      transform: none; 
      box-shadow: none; 
    }
    .login-btn:disabled::before {
      display: none;
    }
    .admin-btn { padding: 0.5em 1.2em; font-size: 0.9em; border-radius: 6px; border: none; cursor: pointer; font-weight: 500; transition: all 0.2s; }
    .btn-primary { background: #667eea; color: #fff; }
    .btn-primary:hover { background: #5a67d8; }
    .btn-success { background: #10b981; color: #fff; }
    .btn-success:hover { background: #059669; }
    .btn-danger { background: #ef4444; color: #fff; }
    .btn-danger:hover { background: #dc2626; }
    .btn-secondary { background: #6b7280; color: #fff; }
    .btn-secondary:hover { background: #4b5563; }
    button:disabled { background: #9ca3af !important; cursor: not-allowed; transform: none; }
    
    /* åå°ç®¡ç†æ ·å¼ */
    .system-logo { 
      font-size: 2.2em; 
      font-weight: 700; 
      color: #667eea; 
      margin-bottom: 0.3em; 
      text-shadow: 0 2px 4px rgba(102, 126, 234, 0.1);
    }
    .system-title { 
      font-size: 1.6em; 
      font-weight: 700; 
      color: #1f2937; 
      margin-bottom: 0.3em; 
      letter-spacing: -0.5px;
      line-height: 1.2;
    }
    .system-desc { 
      color: #6b7280; 
      font-size: 0.95em; 
      margin-bottom: 1.2em; 
      line-height: 1.4;
      font-weight: 400;
    }
    .admin-title { display: flex; align-items: center; justify-content: space-between; }
    .admin-title h2 { margin: 0; color: #1f2937; font-size: 1.4em; font-weight: 600; }
    .admin-user { display: flex; align-items: center; gap: 0.5em; color: #6b7280; font-size: 0.9em; }
    .config-panel { background: #fff; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); padding: 1em; margin-bottom: 0.8em; }
    .panel-title { font-size: 1.1em; font-weight: 600; color: #1f2937; margin-bottom: 0.6em; border-bottom: 1px solid #e5e7eb; padding-bottom: 0.3em; }
    
    /* å¼€å…³æ ·å¼ */
    .switch-container { display: flex; align-items: center; gap: 1em; margin: 0.5em 0; }
    .switch { position: relative; display: inline-block; width: 60px; height: 32px; }
    .switch input { opacity: 0; width: 0; height: 0; }
    .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #cbd5e1; transition: .4s; border-radius: 32px; }
    .slider:before { position: absolute; content: ""; height: 24px; width: 24px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
    input:checked + .slider { background-color: #667eea; }
    input:checked + .slider:before { transform: translateX(28px); }
    .switch-label { font-weight: 600; color: #374151; }
    .switch-status { font-size: 0.85em; padding: 0.3em 0.8em; border-radius: 20px; font-weight: 500; }
    .switch-status.enabled { background: #d1fae5; color: #065f46; }
    .switch-status.disabled { background: #fee2e2; color: #991b1b; }
    
    /* URLè¾“å…¥ä¼˜åŒ–æ ·å¼ */
    .url-input-container { display: flex; gap: 0.5em; align-items: stretch; }
    .url-input-container input { flex: 1; margin: 0; }
    .test-url-btn, .clear-url-btn { width: 42px; padding: 0.6em; border-radius: 6px; cursor: pointer; font-size: 1em; transition: all 0.2s; border: none; }
    .test-url-btn { background: #dbeafe; color: #1d4ed8; }
    .test-url-btn:hover { background: #bfdbfe; }
    .test-url-btn:disabled { background: #f3f4f6; color: #9ca3af; cursor: not-allowed; }
    .clear-url-btn { background: #fecaca; color: #dc2626; }
    .clear-url-btn:hover { background: #fca5a5; }
    .clear-url-btn:disabled { background: #f3f4f6; color: #9ca3af; cursor: not-allowed; }
    
    .url-validation { margin-top: 0.6em; padding: 0.6em; border-radius: 8px; font-size: 0.9em; border-left: 4px solid; }
    .url-validation.valid { background: #ecfdf5; color: #065f46; border-left-color: #10b981; }
    .url-validation.invalid { background: #fef2f2; color: #991b1b; border-left-color: #ef4444; }
    .url-validation.testing { background: #eff6ff; color: #1e40af; border-left-color: #3b82f6; }
    
    .quick-urls { margin-top: 0.8em; padding: 1em; background: #f8fafc; border-radius: 12px; border: 1px solid #e2e8f0; }
    .url-buttons { display: flex; flex-wrap: wrap; gap: 0.4em; }
    .quick-url-btn { padding: 0.4em 0.8em; background: #fff; border: 1px solid #d1d5db; border-radius: 6px; cursor: pointer; font-size: 0.8em; transition: all 0.2s; color: #374151; font-weight: 500; }
    .quick-url-btn:hover { border-color: #667eea; color: #667eea; background: #f8faff; transform: translateY(-1px); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .quick-url-btn:active { transform: translateY(0); }
    
    /* å“åº”å¼å¸ƒå±€ */
    @media (max-width: 768px) {
      body::after {
        animation-duration: 20s; /* ç§»åŠ¨è®¾å¤‡ä¸ŠåŠ¨ç”»ç¨æ…¢ */
      }
      .login-container { 
        padding: 1em; 
        height: 100vh;
        overflow: hidden;
      }
      .admin-container { margin: 0; }
      .admin-header { padding: 1em; }
      .admin-content { padding: 1em; }
      .url-buttons { flex-direction: column; }
      .quick-url-btn { text-align: center; }
      .url-input-container { flex-direction: column; }
      .test-url-btn, .clear-url-btn { width: 100%; margin-top: 0.5em; }
      .admin-title { flex-direction: column; align-items: flex-start; gap: 1em; }
      .login-card { 
        padding: 1.5em 1.2em; 
        background: rgba(255, 255, 255, 0.98); /* ç§»åŠ¨è®¾å¤‡ä¸Šæ›´é«˜ä¸é€æ˜åº¦ */
        backdrop-filter: blur(5px); /* ç§»åŠ¨è®¾å¤‡ä¸Šå‡å°‘æ¨¡ç³Š */
        border-radius: 14px;
      }
      .system-logo { font-size: 1.8em; }
      .system-title { font-size: 1.3em; }
      .system-desc { font-size: 0.9em; }
    .field { margin-bottom: 1em; }
      .field:last-of-type { margin-bottom: 1.2em; }
      input { 
        padding: 0.7em 0.9em; 
        font-size: 0.95em; 
      }
      .login-btn { 
        padding: 0.8em 1em; 
        font-size: 1em; 
      }
      .security-notice {
        padding: 0.7em;
        margin-bottom: 1em;
      }
      .footer-info {
        margin-top: 0.8em;
        padding-top: 0.8em;
      }
      .version {
        font-size: 0.8em;
      }
      .copyright {
        font-size: 0.75em;
      }
    }
    
    .msg { margin: 0.8em 0; padding: 0.7em; border-radius: 8px; font-weight: 500; border-left: 4px solid; }
    .msg.success { background: #ecfdf5; color: #065f46; border-left-color: #10b981; }
    .msg.error { background: #fef2f2; color: #991b1b; border-left-color: #ef4444; }
    .msg.info { background: #eff6ff; color: #1e40af; border-left-color: #3b82f6; }
    .msg.warning { background: #fffbeb; color: #92400e; border-left-color: #f59e0b; }
    .page { display: none; }
    .page.active { display: block; }
    .button-group { display: flex; gap: 1em; margin-top: 1em; }
    .button-group .admin-btn { flex: 1; }
    .config-preview { background: #f8fafc; border-radius: 12px; padding: 1em; margin: 0.8em 0; border: 1px solid #e2e8f0; }
    .config-preview h4 { margin: 0 0 0.6em 0; color: #374151; font-size: 1em; font-weight: 600; }
    .config-json { font-family: 'Monaco', 'Menlo', monospace; background: #fff; padding: 0.8em; border-radius: 8px; border: 1px solid #d1d5db; font-size: 0.9em; line-height: 1.5; }
    .config-summary { background: #fff; padding: 0; border-radius: 8px; border: 1px solid #d1d5db; }
    .summary-item { display: flex; align-items: center; justify-content: space-between; padding: 0.6em 1em; border-bottom: 1px solid #f3f4f6; transition: background-color 0.2s ease; }
    .summary-item:last-child { border-bottom: none; }
    .summary-item:hover { background-color: #f8fafc; }
    .summary-label { font-weight: 600; color: #374151; font-size: 0.9em; }
    .summary-value { font-weight: 600; font-size: 0.9em; }
    
    /* é…ç½®è¯»å–æœºåˆ¶æ ·å¼ */
    .config-mechanism { background: #f1f5f9; border-radius: 12px; padding: 0; margin: 0.8em 0; border: 1px solid #cbd5e1; overflow: hidden; }
    .mechanism-header { display: flex; align-items: center; justify-content: space-between; padding: 1em; cursor: pointer; transition: all 0.2s ease; background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%); border-bottom: 1px solid #cbd5e1; }
    .mechanism-header:hover { background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%); }
    .mechanism-header h4 { margin: 0; color: #374151; font-size: 1em; font-weight: 600; }
    .mechanism-toggle { font-size: 0.8em; color: #6b7280; font-weight: 600; transition: transform 0.3s ease; }
    .mechanism-toggle.expanded { transform: rotate(180deg); }
    .mechanism-content { background: #fff; padding: 1em; animation: slideDown 0.3s ease-out; }
    .mechanism-section { margin-bottom: 1em; }
    .mechanism-section:last-child { margin-bottom: 0; }
    .mechanism-section h5 { margin: 0 0 0.6em 0; color: #1f2937; font-size: 0.95em; font-weight: 600; padding-bottom: 0.3em; border-bottom: 1px solid #e5e7eb; }
    .mechanism-items { display: flex; flex-direction: column; gap: 0.4em; }
    .mechanism-item { display: flex; align-items: center; padding: 0.5em 0; }
    .item-label { font-weight: 500; color: #4b5563; font-size: 0.85em; min-width: 140px; }
    .item-value { font-weight: 600; color: #1f2937; font-size: 0.85em; background: #f8fafc; padding: 0.2em 0.6em; border-radius: 4px; }
    
    /* æµç¨‹å›¾æ ·å¼ */
    .flow-diagram { display: flex; flex-direction: column; align-items: center; gap: 0.5em; padding: 0.8em; background: #f9fafb; border-radius: 8px; border: 1px solid #e5e7eb; }
    .flow-step { background: #3b82f6; color: #fff; padding: 0.5em 1em; border-radius: 6px; font-size: 0.85em; font-weight: 600; text-align: center; }
    .flow-arrow { color: #6b7280; font-size: 1.2em; font-weight: 600; }
    .flow-branch { width: 100%; }
    .flow-path { display: flex; align-items: center; justify-content: center; gap: 0.6em; padding: 0.3em; }
    .flow-condition { background: #fbbf24; color: #92400e; padding: 0.3em 0.6em; border-radius: 4px; font-size: 0.8em; font-weight: 600; }
    .flow-arrow-right { color: #6b7280; font-size: 1em; font-weight: 600; }
    .flow-result { background: #10b981; color: #fff; padding: 0.3em 0.6em; border-radius: 4px; font-size: 0.8em; font-weight: 600; }
    
    /* å±•å¼€åŠ¨ç”» */
    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* ç§»åŠ¨ç«¯é€‚é… */
    @media (max-width: 768px) {
      .mechanism-header { padding: 0.8em; }
      .mechanism-header h4 { font-size: 0.9em; }
      .mechanism-content { padding: 0.8em; }
      .flow-path { flex-direction: column; gap: 0.3em; text-align: center; }
      .flow-arrow-right { transform: rotate(90deg); }
      .item-label { min-width: auto; margin-bottom: 0.2em; }
      .mechanism-item { flex-direction: column; align-items: flex-start; padding: 0.4em 0; }
    }
    .security-notice { 
      background: linear-gradient(135deg, #fef3c7 0%, #fef3c7 100%); 
      border: 1px solid #f59e0b; 
      border-radius: 10px; 
      padding: 0.8em; 
      margin-bottom: 1.2em; 
      position: relative;
      box-shadow: 0 2px 8px rgba(245, 158, 11, 0.1);
      text-align: left;
    }
    .security-notice::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, #f59e0b, #d97706, #f59e0b);
      border-radius: 12px 12px 0 0;
    }
    .security-notice .icon { 
      color: #d97706; 
      font-size: 1.3em; 
      margin-right: 0.6em; 
      vertical-align: middle;
    }
    .security-notice strong {
      color: #92400e;
      font-weight: 600;
    }
    
    /* ä¸»è¦å†…å®¹åŒºåŸŸ */
    .login-main {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      min-height: 0;
    }
    
    /* ç‰ˆæƒä¿¡æ¯æ ·å¼ */
    .footer-info {
      text-align: center; 
      margin-top: 1.2em; 
      padding-top: 1.2em; 
      border-top: 1px solid rgba(229, 231, 235, 0.6); 
      position: relative;
      flex-shrink: 0;
    }
    .footer-info::before {
      content: '';
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 1px;
      background: linear-gradient(90deg, transparent, #667eea, transparent);
    }
    .version {
      margin: 0 0 0.4em 0;
      color: #6b7280;
      font-size: 0.85em;
      font-weight: 500;
    }
    .copyright {
      margin: 0;
      color: #9ca3af;
      font-size: 0.8em;
      font-weight: 400;
      letter-spacing: 0.2px;
    }
    
    /* ç™»å½•é¡µé¢åŠ¨ç”»æ•ˆæœ */
    .login-card { 
      animation: slideUp 0.8s ease-out; 
    }
    @keyframes slideUp { 
      from { opacity: 0; transform: translateY(30px) scale(0.98); } 
      to { opacity: 1; transform: translateY(0) scale(1); } 
    }
    
    /* è¾“å…¥æ¡†æµ®åŠ¨æ ‡ç­¾æ•ˆæœ */
    .field {
      position: relative;
    }
    .field label {
      transition: all 0.3s ease;
    }
    .field input:focus + label,
    .field input:not(:placeholder-shown) + label {
      transform: translateY(-0.5em);
      font-size: 0.85em;
      color: #667eea;
    }
    
    /* å¢å¼ºçš„èšç„¦æ•ˆæœ */
    input:focus {
      animation: focusGlow 0.4s ease;
    }
    @keyframes focusGlow {
      0% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.1); }
      50% { box-shadow: 0 0 0 6px rgba(102, 126, 234, 0.15); }
      100% { box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1); }
    }
    
    /* é¡µé¢è¿‡æ¸¡åŠ¨ç”» */
    .page { transition: opacity 0.3s ease-in-out; }
    .page:not(.active) { opacity: 0; }
    .page.active { opacity: 1; }
    
    /* æŒ‰é’®çŠ¶æ€åŠ¨ç”» */
    .login-btn.success { 
      animation: pulse 0.3s ease-in-out; 
    }
    @keyframes pulse { 
      0% { transform: scale(1); } 
      50% { transform: scale(1.02); } 
      100% { transform: scale(1); } 
    }
    
    /* åŠ è½½çŠ¶æ€åŠ¨ç”» */
    .login-btn.loading {
      position: relative;
      color: transparent;
    }
    .login-btn.loading::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-top: 2px solid #fff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: translate(-50%, -50%) rotate(0deg); }
      100% { transform: translate(-50%, -50%) rotate(360deg); }
    }
    
    /* é”™è¯¯çŠ¶æ€æŠ–åŠ¨åŠ¨ç”» */
    .login-btn.error {
      animation: shake 0.5s ease-in-out;
    }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-3px); }
      20%, 40%, 60%, 80% { transform: translateX(3px); }
    }
  </style>
</head>
<body>
  <!-- ç™»å½•é¡µé¢ -->
  <div id="loginPage" class="page active">
    <div class="login-container">
      <div class="login-card">
        <div class="login-main">
          <div class="system-logo">âš™ï¸</div>
          <h1 class="system-title">åº”ç”¨é…ç½®ç®¡ç†å¹³å°</h1>
          <p class="system-desc">é›†ä¸­ç®¡ç†å’Œé…ç½®æ‚¨çš„åº”ç”¨å‚æ•°ï¼Œå®‰å…¨ã€é«˜æ•ˆã€å¯é </p>
          
          <div class="security-notice">
            <span class="icon">ğŸ”’</span>
            <strong>å®‰å…¨æç¤ºï¼š</strong>è¯·ç¡®ä¿æ‚¨çš„è®¿é—®å‡­æ®å®‰å…¨ï¼Œå¹³å°é‡‡ç”¨ç«¯åˆ°ç«¯åŠ å¯†ä¿æŠ¤æ‚¨çš„æ•°æ®
          </div>
          
          <div class="field">
            <label for="gistId">App ID</label>
            <input id="gistId" placeholder="è¯·è¾“å…¥æ‚¨çš„åº”ç”¨æ ‡è¯†ç¬¦" autocomplete="off">
          </div>
          
    <div class="field">
            <label for="token">è®¿é—®ä»¤ç‰Œ</label>
            <input id="token" type="password" placeholder="è¯·è¾“å…¥æ‚¨çš„è®¿é—®ä»¤ç‰Œ" autocomplete="off">
          </div>
          
          <button onclick="connectToGist()" id="connectBtn" class="login-btn">è¿æ¥åˆ°APPåº”ç”¨</button>
          
          <div id="loginMsg" class="msg info" style="display:none;"></div>
        </div>
        
        <div class="footer-info">
          <p class="version">åº”ç”¨é…ç½®ç®¡ç†å¹³å° v2.1.0</p>
          <p class="copyright">Â© 2024 Enterprise Config Solutions</p>
        </div>
      </div>
    </div>
  </div>

    <!-- ç®¡ç†é¡µé¢ -->
    <div id="editPage" class="page">
      <div class="admin-container">
        <div class="admin-header">
          <div class="admin-title">
            <h2>ğŸ›ï¸ åº”ç”¨é…ç½®æ§åˆ¶å°</h2>
            <div class="admin-user">
              <span>ğŸŸ¢ è¿æ¥çŠ¶æ€ï¼š<span style="color: #10b981; font-weight: 600;">å·²è¿æ¥</span></span>
              <span style="margin-left: 2em;">ğŸ“Š App IDï¼š<span id="currentAppId" style="color: #6b7280; font-weight: 600; font-family: monospace;">-</span></span>
            </div>
          </div>
        </div>
        
        <div class="admin-content">
          <div class="config-panel">
            <div class="panel-title">âš™ï¸ åº”ç”¨ç‰ˆæœ¬é…ç½®</div>
            
            <div class="field">
              <label for="versionInput">åº”ç”¨ç‰ˆæœ¬å·</label>
              <input type="number" id="versionInput" placeholder="ä¾‹å¦‚ï¼š1" min="1" oninput="updateVersion()" onblur="updateVersion()">
              <div id="versionValidation" class="url-validation" style="display: none;"></div>
              <small style="color: #6b7280; margin-top: 0.5em; display: block;">
                åº”ç”¨çš„ç‰ˆæœ¬æ ‡è¯†ï¼Œåªèƒ½è®¾ç½®ä¸ºé€’å¢çš„æ•´æ•°ï¼ˆ1, 2, 3...ï¼‰ï¼Œç”¨äºç‰ˆæœ¬ç®¡ç†å’Œå…¼å®¹æ€§æ§åˆ¶
              </small>
            </div>
          </div>

          <div class="config-panel">
            <div class="panel-title">ğŸŒ é¡µé¢é‡å®šå‘ç®¡ç†</div>
            
            <div class="field">
              <label class="switch-label">é‡å®šå‘åŠŸèƒ½çŠ¶æ€</label>
              <div class="switch-container">
                <label class="switch">
                  <input type="checkbox" id="redirectEnabled" onchange="updateRedirectEnabled()">
                  <span class="slider"></span>
                </label>
                <span id="redirectStatus" class="switch-status enabled">å·²å¯ç”¨</span>
              </div>
              <small style="color: #6b7280; margin-top: 0.5em; display: block;">
                å¼€å¯åï¼Œç”¨æˆ·è®¿é—®é¡µé¢å°†è‡ªåŠ¨è·³è½¬åˆ°æŒ‡å®šåœ°å€
              </small>
            </div>
      
    <div class="field">
              <label for="redirectUrlInput">ç›®æ ‡è·³è½¬åœ°å€ <span style="color: #ef4444;">*</span></label>
              <div class="url-input-container">
                <input type="url" id="redirectUrlInput" placeholder="è¾“å…¥ç½‘å€ï¼Œå¦‚ï¼šexample.com" oninput="updateRedirectUrl()" onblur="validateUrl()" required>
                <button type="button" class="clear-url-btn" onclick="clearUrl()" id="clearBtn" title="é‡ç½®ä¸ºé»˜è®¤åœ°å€">ğŸ”„</button>
                <button type="button" class="test-url-btn" onclick="testUrl()" id="testBtn" title="æµ‹è¯•é“¾æ¥">ğŸ”—</button>
              </div>
              <div id="urlValidation" class="url-validation" style="display: none;"></div>
              
              <div class="quick-urls">
                <label style="font-size: 0.9em; color: #6b7280; margin-bottom: 0.8em; display: block; font-weight: 600;">âš¡ å¿«é€Ÿé…ç½®æ¨¡æ¿ï¼š</label>
                <div class="url-buttons">
                  <button type="button" class="quick-url-btn" onclick="setQuickUrl('https://flutter.dev/')">Flutter</button>
                  <button type="button" class="quick-url-btn" onclick="setQuickUrl('https://github.com/')">GitHub</button>
                  <button type="button" class="quick-url-btn" onclick="setQuickUrl('https://docs.flutter.dev/')">Flutteræ–‡æ¡£</button>
                  <button type="button" class="quick-url-btn" onclick="setQuickUrl('https://pub.dev/')">Pub.dev</button>
                  <button type="button" class="quick-url-btn" onclick="setQuickUrl('https://developer.android.com/')">Android</button>
                  <button type="button" class="quick-url-btn" onclick="setQuickUrl('https://developer.apple.com/')">iOS</button>
                  <button type="button" class="quick-url-btn" onclick="setQuickUrl('https://stackoverflow.com/')">Stack Overflow</button>
                  <button type="button" class="quick-url-btn" onclick="setQuickUrl('https://npmjs.com/')">npm</button>
                  <button type="button" class="quick-url-btn" onclick="setQuickUrl('https://www.google.com/')">Google</button>
                  <button type="button" class="quick-url-btn" onclick="setQuickUrl('https://www.bilibili.com/')">å“”å“©å“”å“©</button>
                </div>
              </div>
              
              <small style="color: #6b7280; margin-top: 1em; display: block;">
                ğŸ’¡ æç¤ºï¼šæ­¤å­—æ®µä¸ºå¿…å¡«é¡¹ï¼Œæ”¯æŒä»»ä½•æœ‰æ•ˆçš„ç½‘å€ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨éªŒè¯é“¾æ¥çš„å¯è®¿é—®æ€§
              </small>
            </div>
          </div>
      
          <div class="config-preview">
            <h4>ğŸ“‹ é…ç½®æ¦‚è§ˆ</h4>
            <div class="config-summary">
              <div class="summary-item">
                <span class="summary-label">ğŸ“¦ åº”ç”¨ç‰ˆæœ¬ï¼š</span>
                <span id="previewVersionText" class="summary-value" style="color: #9333ea;">ç¬¬ 1 ç‰ˆ</span>
              </div>
              <div class="summary-item">
                <span class="summary-label">ğŸ”„ é‡å®šå‘åŠŸèƒ½ï¼š</span>
                <span id="previewEnabledText" class="summary-value" style="color: #ef4444;">å·²å…³é—­</span>
              </div>
              <div class="summary-item">
                <span class="summary-label">ğŸ¯ è·³è½¬ç›®æ ‡ï¼š</span>
                <span id="previewUrlText" class="summary-value" style="color: #1d4ed8;">https://example.com</span>
              </div>
            </div>
          </div>

          <div class="config-mechanism">
            <div class="mechanism-header" onclick="toggleConfigMechanism()">
              <h4>ğŸ“– é…ç½®è¯»å–æœºåˆ¶</h4>
              <span id="mechanismToggle" class="mechanism-toggle">â–¼</span>
            </div>
            <div id="mechanismContent" class="mechanism-content" style="display: none;">
              <div class="mechanism-section">
                <h5>ğŸ”„ è¯»å–æ—¶æœº</h5>
                <div class="mechanism-items">
                  <div class="mechanism-item">
                    <span class="item-label">åº”ç”¨å¯åŠ¨:</span>
                    <span class="item-value">ç«‹å³æ£€æŸ¥</span>
                  </div>
                  <div class="mechanism-item">
                    <span class="item-label">æ¢å¤å‰å°:</span>
                    <span class="item-value">ç«‹å³æ£€æŸ¥</span>
                  </div>
                  <div class="mechanism-item">
                    <span class="item-label">å®šæ—¶æ£€æŸ¥:</span>
                    <span class="item-value">å‰å°2åˆ†é’Ÿé—´éš”</span>
                  </div>
                </div>
              </div>

              <div class="mechanism-section">
                <h5>ğŸ” ç‰ˆæœ¬å·æ¯”è¾ƒæœºåˆ¶</h5>
                <div class="mechanism-items">
                  <div class="mechanism-item">
                    <span class="item-label">è·å–æœ¬åœ°ç‰ˆæœ¬å·:</span>
                    <span class="item-value">ä»ç¼“å­˜è¯»å–</span>
                  </div>
                  <div class="mechanism-item">
                    <span class="item-label">è½»é‡çº§æ£€æŸ¥è¿œç¨‹ç‰ˆæœ¬:</span>
                    <span class="item-value">ä½¿ç”¨ETagä¼˜åŒ–</span>
                  </div>
                  <div class="mechanism-item">
                    <span class="item-label">ç‰ˆæœ¬å·å¯¹æ¯”:</span>
                    <span class="item-value">ä¸åŒåˆ™è§¦å‘æ›´æ–°</span>
                  </div>
                  <div class="mechanism-item">
                    <span class="item-label">å®Œæ•´é…ç½®ä¸‹è½½:</span>
                    <span class="item-value">ä»…åœ¨ç‰ˆæœ¬å˜åŒ–æ—¶</span>
                  </div>
                </div>
              </div>

              <div class="mechanism-section">
                <h5>ğŸ“Š è¯»å–æµç¨‹</h5>
                <div class="flow-diagram">
                  <div class="flow-step">æœ¬åœ°ç‰ˆæœ¬ vs è¿œç¨‹ç‰ˆæœ¬</div>
                  <div class="flow-arrow">â†“</div>
                  <div class="flow-branch">
                    <div class="flow-path">
                      <span class="flow-condition">ç‰ˆæœ¬ç›¸åŒ</span>
                      <span class="flow-arrow-right">â†’</span>
                      <span class="flow-result">ä½¿ç”¨ç¼“å­˜</span>
                    </div>
                  </div>
                  <div class="flow-arrow">â†“</div>
                  <div class="flow-branch">
                    <div class="flow-path">
                      <span class="flow-condition">ç‰ˆæœ¬ä¸åŒ</span>
                      <span class="flow-arrow-right">â†’</span>
                      <span class="flow-result">ä¸‹è½½æ–°é…ç½®</span>
                    </div>
                  </div>
                  <div class="flow-arrow">â†“</div>
                  <div class="flow-branch">
                    <div class="flow-path">
                      <span class="flow-condition">ç½‘ç»œå¤±è´¥</span>
                      <span class="flow-arrow-right">â†’</span>
                      <span class="flow-result">ä½¿ç”¨ç¼“å­˜/é»˜è®¤</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="button-group">
            <button onclick="saveToGist()" id="saveBtn" class="admin-btn btn-success">ğŸ’¾ ä¿å­˜é…ç½®</button>
            <button onclick="backToLogin()" class="admin-btn btn-danger">ğŸšª é€€å‡ºAPPåº”ç”¨</button>
          </div>
          
          <div id="editMsg" class="msg info" style="display:none;"></div>
        </div>
      </div>
    </div>
  </div>
  <script>
    // å…¨å±€çŠ¶æ€
    let currentJson = null;
    let currentGistId = null;
    let currentToken = null;
    let currentFileName = null;
    let currentFileInfo = null;

    // é¡µé¢åˆ‡æ¢
    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
      document.getElementById(pageId).classList.add('active');
    }

    // é…ç½®è¯»å–æœºåˆ¶å±•å¼€/æŠ˜å 
    function toggleConfigMechanism() {
      const content = document.getElementById('mechanismContent');
      const toggle = document.getElementById('mechanismToggle');
      
      if (content.style.display === 'none') {
        content.style.display = 'block';
        toggle.textContent = 'â–²';
        toggle.classList.add('expanded');
      } else {
        content.style.display = 'none';
        toggle.textContent = 'â–¼';
        toggle.classList.remove('expanded');
      }
    }

    // è¿”å›ç™»å½•é¡µé¢
    function backToLogin() {
      currentJson = null;
      currentGistId = null;
      currentToken = null;
      currentFileName = null;
      currentFileInfo = null;
      
      // æ¸…é™¤App IDæ˜¾ç¤º
      document.getElementById('currentAppId').textContent = '-';
      
      showPage('loginPage');
      showLoginMsg('è¯·è¾“å…¥åº”ç”¨å‡­æ®ä»¥è®¿é—®é…ç½®ç®¡ç†æ§åˆ¶å°', 'info');
    }

    // åŠ è½½é…ç½®åˆ°ç•Œé¢
    function loadRedirectConfig() {
      if (!currentJson) return;
      
      const version = currentJson.version || '1';
      const isEnabled = currentJson.isRedirectEnabled || false;
      let redirectUrl = currentJson.redirectUrl;
      
      // å¦‚æœredirectUrlä¸ºnullæˆ–ç©ºï¼Œè®¾ç½®é»˜è®¤å€¼
      if (!redirectUrl || redirectUrl === null) {
        redirectUrl = 'https://example.com';
        currentJson.redirectUrl = redirectUrl;
      }
      
      // æ›´æ–°ç•Œé¢å…ƒç´ 
      document.getElementById('versionInput').value = parseInt(version);
      document.getElementById('redirectEnabled').checked = isEnabled;
      document.getElementById('redirectUrlInput').value = redirectUrl;
      
      // æ¸…é™¤éªŒè¯ä¿¡æ¯
      const versionValidation = document.getElementById('versionValidation');
      const urlValidation = document.getElementById('urlValidation');
      versionValidation.style.display = 'none';
      urlValidation.style.display = 'none';
      
      // æ›´æ–°çŠ¶æ€æ–‡å­—å’Œé¢„è§ˆ
      updateRedirectStatus();
      updateConfigPreview();
      
      // è‡ªåŠ¨éªŒè¯åŠ è½½çš„URL
      validateUrl();
    }

    // æ›´æ–°ç‰ˆæœ¬ä¿¡æ¯
    function updateVersion() {
      const input = document.getElementById('versionInput');
      const validation = document.getElementById('versionValidation');
      let newVersion = parseInt(input.value);
      
      // è·å–å½“å‰ç‰ˆæœ¬å·
      const currentVersion = parseInt(currentJson.version) || 0;
      
      // ç‰ˆæœ¬å·éªŒè¯
      if (!newVersion || newVersion < 1) {
        newVersion = Math.max(1, currentVersion);
        input.value = newVersion;
        validation.className = 'url-validation invalid';
        validation.innerHTML = 'âŒ ç‰ˆæœ¬å·å¿…é¡»æ˜¯å¤§äº0çš„æ•´æ•°';
        validation.style.display = 'block';
      } else if (newVersion < currentVersion) {
        // ç‰ˆæœ¬å·ä¸èƒ½é€’å‡
        input.value = currentVersion;
        validation.className = 'url-validation invalid';
        validation.innerHTML = `âŒ ç‰ˆæœ¬å·åªèƒ½é€’å¢ï¼Œå½“å‰ç‰ˆæœ¬ä¸º ${currentVersion}ï¼Œè¯·è¾“å…¥å¤§äºç­‰äº ${currentVersion} çš„ç‰ˆæœ¬å·`;
        validation.style.display = 'block';
        return;
      } else if (newVersion === currentVersion) {
        // ç‰ˆæœ¬å·ç›¸åŒ
        validation.className = 'url-validation info';
        validation.innerHTML = `â„¹ï¸ ç‰ˆæœ¬å·ä¿æŒä¸å˜ï¼š${newVersion}`;
        validation.style.display = 'block';
            } else {
        // ç‰ˆæœ¬å·é€’å¢
        validation.className = 'url-validation valid';
        validation.innerHTML = `âœ… ç‰ˆæœ¬å·ä» ${currentVersion} å‡çº§åˆ° ${newVersion}`;
        validation.style.display = 'block';
      }
      
      currentJson.version = String(newVersion);
      updateConfigPreview();
    }

    // æ›´æ–°é‡å®šå‘å¯ç”¨çŠ¶æ€
    function updateRedirectEnabled() {
      const isEnabled = document.getElementById('redirectEnabled').checked;
      currentJson.isRedirectEnabled = isEnabled;
      updateRedirectStatus();
      updateConfigPreview();
    }

    // æ›´æ–°é‡å®šå‘URL
    function updateRedirectUrl() {
      let url = document.getElementById('redirectUrlInput').value.trim();
      const validation = document.getElementById('urlValidation');
      
      // URLä¸èƒ½ä¸ºç©º
      if (!url) {
        validation.className = 'url-validation invalid';
        validation.innerHTML = 'âŒ ç›®æ ‡è·³è½¬åœ°å€ä¸èƒ½ä¸ºç©ºï¼Œè¯·è¾“å…¥æœ‰æ•ˆçš„ç½‘å€';
        validation.style.display = 'block';
        return;
      }
      
      // è‡ªåŠ¨æ·»åŠ  https:// å‰ç¼€ï¼ˆå¦‚æœç”¨æˆ·è¾“å…¥çš„æ˜¯çº¯åŸŸåï¼‰
      if (!url.startsWith('http://') && !url.startsWith('https://')) {
        // æ£€æŸ¥æ˜¯å¦çœ‹èµ·æ¥åƒåŸŸåï¼ˆåŒ…å«ç‚¹å·ä½†ä¸æ˜¯æ–‡ä»¶è·¯å¾„ï¼‰
        if (url.includes('.') && !url.startsWith('/') && !url.includes(' ')) {
          url = 'https://' + url;
          document.getElementById('redirectUrlInput').value = url;
        }
      }
      
      currentJson.redirectUrl = url;
      updateConfigPreview();
      // éšè—éªŒè¯çŠ¶æ€ï¼Œç­‰å¾…æ ¼å¼éªŒè¯
      validation.style.display = 'none';
    }

    // å¿«é€Ÿè®¾ç½®é¢„è®¾URL
    function setQuickUrl(url) {
      document.getElementById('redirectUrlInput').value = url;
      currentJson.redirectUrl = url;
      updateConfigPreview();
      validateUrl();
    }

    // é‡ç½®URLä¸ºé»˜è®¤åœ°å€
    function clearUrl() {
      const defaultUrl = 'https://example.com';
      document.getElementById('redirectUrlInput').value = defaultUrl;
      currentJson.redirectUrl = defaultUrl;
      updateConfigPreview();
      validateUrl();
      // æ˜¾ç¤ºé‡ç½®æç¤º
      const validation = document.getElementById('urlValidation');
      validation.className = 'url-validation info';
      validation.innerHTML = 'ğŸ”„ å·²é‡ç½®ä¸ºé»˜è®¤åœ°å€';
      validation.style.display = 'block';
    }

    // éªŒè¯URLæ ¼å¼
    function validateUrl() {
      const input = document.getElementById('redirectUrlInput');
      const url = input.value.trim();
      const validation = document.getElementById('urlValidation');
      
      if (!url) {
        validation.className = 'url-validation invalid';
        validation.innerHTML = 'âŒ ç›®æ ‡è·³è½¬åœ°å€ä¸èƒ½ä¸ºç©ºï¼Œè¯·è¾“å…¥æœ‰æ•ˆçš„ç½‘å€';
        validation.style.display = 'block';
        return false;
      }

      try {
        const urlObj = new URL(url);
        if (urlObj.protocol === 'http:' || urlObj.protocol === 'https:') {
          validation.className = 'url-validation valid';
          validation.innerHTML = 'âœ… URLæ ¼å¼æ­£ç¡®';
          validation.style.display = 'block';
          return true;
        } else {
          validation.className = 'url-validation invalid';
          validation.innerHTML = 'âŒ è¯·ä½¿ç”¨ http:// æˆ– https:// å¼€å¤´çš„ç½‘å€';
          validation.style.display = 'block';
          return false;
        }
      } catch (e) {
        validation.className = 'url-validation invalid';
        validation.innerHTML = 'âŒ æ— æ•ˆçš„URLæ ¼å¼ï¼Œè¯·æ£€æŸ¥ç½‘å€æ˜¯å¦æ­£ç¡®';
        validation.style.display = 'block';
        return false;
      }
    }

    // æµ‹è¯•URLæ˜¯å¦å¯è®¿é—®
    function testUrl() {
      const input = document.getElementById('redirectUrlInput');
      const url = input.value.trim();
      const validation = document.getElementById('urlValidation');
      const testBtn = document.getElementById('testBtn');
      
      if (!url) {
        validation.className = 'url-validation invalid';
        validation.innerHTML = 'âŒ è¯·å…ˆè¾“å…¥è¦æµ‹è¯•çš„ç½‘å€';
        validation.style.display = 'block';
        return;
      }

      try {
        new URL(url); // å…ˆéªŒè¯URLæ ¼å¼
      } catch (e) {
        validation.className = 'url-validation invalid';
        validation.innerHTML = 'âŒ è¯·è¾“å…¥æœ‰æ•ˆçš„ç½‘å€æ ¼å¼';
        validation.style.display = 'block';
        return;
      }

      // æ˜¾ç¤ºæµ‹è¯•ä¸­çŠ¶æ€
      validation.className = 'url-validation testing';
      validation.innerHTML = 'ğŸ”„ æ­£åœ¨æµ‹è¯•é“¾æ¥å¯è®¿é—®æ€§...';
      validation.style.display = 'block';
      testBtn.disabled = true;
      testBtn.innerHTML = 'â³';

      // ä½¿ç”¨fetchæµ‹è¯•é“¾æ¥ï¼ˆæ³¨æ„ï¼šç”±äºCORSé™åˆ¶ï¼Œå¯èƒ½æ— æ³•è®¿é—®æ‰€æœ‰ç½‘ç«™ï¼‰
      fetch(url, { 
        method: 'HEAD', 
        mode: 'no-cors',
        timeout: 5000 
      }).then(() => {
        validation.className = 'url-validation valid';
        validation.innerHTML = 'âœ… é“¾æ¥æµ‹è¯•æˆåŠŸï¼Œç½‘ç«™å¯æ­£å¸¸è®¿é—®';
      }).catch((error) => {
        // å¯¹äºno-corsæ¨¡å¼ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ä¼šè¿›å…¥catchï¼Œä½†è¿™ä¸ä»£è¡¨é“¾æ¥æ— æ•ˆ
        validation.className = 'url-validation valid';
        validation.innerHTML = 'âš ï¸ ç”±äºè·¨åŸŸé™åˆ¶æ— æ³•å®Œå…¨éªŒè¯ï¼Œä½†URLæ ¼å¼æ­£ç¡®<br><small>å»ºè®®æ‰‹åŠ¨ç‚¹å‡»éªŒè¯ï¼š<a href="' + url + '" target="_blank" style="color:#1677ff;">æ‰“å¼€é“¾æ¥æµ‹è¯•</a></small>';
      }).finally(() => {
        testBtn.disabled = false;
        testBtn.innerHTML = 'ğŸ”—';
      });
    }

    // æ›´æ–°é‡å®šå‘çŠ¶æ€æ–‡å­—
    function updateRedirectStatus() {
      const isEnabled = document.getElementById('redirectEnabled').checked;
      const statusElement = document.getElementById('redirectStatus');
      
      if (isEnabled) {
        statusElement.textContent = 'å·²å¯ç”¨';
        statusElement.className = 'switch-status enabled';
      } else {
        statusElement.textContent = 'å·²ç¦ç”¨';
        statusElement.className = 'switch-status disabled';
      }
    }

    // æ›´æ–°é…ç½®é¢„è§ˆ
    function updateConfigPreview() {
      const version = currentJson.version || '1';
      const isEnabled = currentJson.isRedirectEnabled;
      const redirectUrl = currentJson.redirectUrl || 'https://example.com';
      
      // æ›´æ–°ç‰ˆæœ¬æ˜¾ç¤º
      document.getElementById('previewVersionText').textContent = `ç¬¬ ${version} ç‰ˆ`;
      document.getElementById('previewVersionText').style.color = '#9333ea';
      
      // æ›´æ–°é‡å®šå‘çŠ¶æ€æ˜¾ç¤º
      const enabledText = isEnabled ? 'å·²å¼€å¯' : 'å·²å…³é—­';
      document.getElementById('previewEnabledText').textContent = enabledText;
      document.getElementById('previewEnabledText').style.color = isEnabled ? '#10b981' : '#ef4444';
      
      // æ›´æ–°è·³è½¬ç›®æ ‡æ˜¾ç¤º
      document.getElementById('previewUrlText').textContent = redirectUrl;
      document.getElementById('previewUrlText').style.color = '#1d4ed8';
    }

    // ä¿å®ˆçš„JSONæ³¨é‡Šæ¸…ç†ï¼ˆä»…å¤„ç†æ³¨é‡Šï¼Œä¸åŠ¨å…¶ä»–å­—ç¬¦ï¼‰
    function removeJsonComments(jsonString) {
      console.log('æ¸…ç†å‰JSON:', jsonString);
      
      // æœ€ä¿å®ˆçš„æ–¹æ³•ï¼šä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ç²¾ç¡®æ¸…ç†æ³¨é‡Š
      let cleanJson = jsonString;
      
      // ç§»é™¤BOMæ ‡è®°
      cleanJson = cleanJson.replace(/^\uFEFF/, '');
      
      // åˆ†è¡Œå¤„ç†ï¼Œé€è¡Œç§»é™¤æ³¨é‡Š
      const lines = cleanJson.split('\n');
      const cleanedLines = lines.map(line => {
        // æŸ¥æ‰¾ // æ³¨é‡Šï¼Œä½†è¦é¿å…åœ¨å­—ç¬¦ä¸²å†…çš„ //
        let inString = false;
        let escapeNext = false;
        let result = '';
        
        for (let i = 0; i < line.length; i++) {
          const char = line[i];
          
          if (escapeNext) {
            result += char;
            escapeNext = false;
            continue;
          }
          
          if (char === '\\' && inString) {
            result += char;
            escapeNext = true;
            continue;
          }
          
          if (char === '"' && !escapeNext) {
            inString = !inString;
            result += char;
            continue;
          }
          
          // å¦‚æœä¸åœ¨å­—ç¬¦ä¸²å†…ï¼Œæ£€æŸ¥æ˜¯å¦æ˜¯æ³¨é‡Šå¼€å§‹
          if (!inString && char === '/' && i + 1 < line.length && line[i + 1] === '/') {
            // æ‰¾åˆ°æ³¨é‡Šï¼Œæˆªæ–­åˆ°è¿™é‡Œ
            break;
          }
          
          result += char;
        }
        
        return result.trimEnd(); // ç§»é™¤è¡Œå°¾ç©ºç™½
      });
      
      // é‡æ–°è¿æ¥è¡Œ
      cleanJson = cleanedLines.join('\n');
      
      // ç§»é™¤å¤šè¡Œæ³¨é‡Š /* */ï¼ˆç®€å•ç‰ˆæœ¬ï¼Œä¸å¤„ç†å­—ç¬¦ä¸²å†…çš„æƒ…å†µï¼‰
      cleanJson = cleanJson.replace(/\/\*[\s\S]*?\*\//g, '');
      
      // ç§»é™¤ç©ºè¡Œ
      cleanJson = cleanJson.replace(/^\s*[\r\n]/gm, '');
      
      const result = cleanJson.trim();
      console.log('æ¸…ç†åJSON:', result);
      
      return result;
    }

    // è§£æ gistId æˆ– url
    function parseGistId(input) {
      if (!input) return '';
      if (/^[a-f0-9]{8,}$/i.test(input)) return input;
      const m = input.match(/gist\.github\.com\/(?:[^\/]+\/)?([a-f0-9]{8,})/i);
      return m ? m[1] : '';
    }

    // è¿æ¥åˆ°ç³»ç»Ÿå¹¶åŠ è½½é…ç½®
    async function connectToGist() {
      const gistInput = document.getElementById('gistId').value.trim();
      const token = document.getElementById('token').value.trim();
      const gistId = parseGistId(gistInput);
      
      if (!gistId) return showLoginMsg('è¯·è¾“å…¥æœ‰æ•ˆçš„åº”ç”¨æ ‡è¯†ç¬¦', 'error');
      if (!token) return showLoginMsg('è¯·è¾“å…¥è®¿é—®ä»¤ç‰Œä»¥è·å¾—ç®¡ç†æƒé™', 'warning');
      
      document.getElementById('connectBtn').disabled = true;
      showLoginMsg('æ­£åœ¨éªŒè¯èº«ä»½å¹¶è¿æ¥åˆ°APPåº”ç”¨...', 'info');
      
      try {
        // æ„å»ºè¯·æ±‚å¤´
        const headers = {
          'Accept': 'application/vnd.github.v3+json',
          'User-Agent': 'App-Config-Manager/1.0',
          'Authorization': `Bearer ${token}`
        };
        
        // è·å– Gist ä¿¡æ¯
        const res = await fetch(`https://api.github.com/gists/${gistId}`, {
          method: 'GET',
          headers: headers,
          mode: 'cors'
        });
        
        if (!res.ok) {
          if (res.status === 404) {
            showLoginMsg('åº”ç”¨èµ„æºä¸å­˜åœ¨æˆ–æ‚¨æ— æƒè®¿é—®', 'error');
          } else if (res.status === 403) {
            showLoginMsg('è®¿é—®æƒé™ä¸è¶³ï¼Œè¯·æ£€æŸ¥æ‚¨çš„è®¿é—®ä»¤ç‰Œæƒé™', 'error');
          } else if (res.status === 401) {
            showLoginMsg('èº«ä»½éªŒè¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥è®¿é—®ä»¤ç‰Œæ˜¯å¦æ­£ç¡®', 'error');
          } else {
            showLoginMsg(`APPåº”ç”¨è¿æ¥å¤±è´¥ï¼š${res.status} ${res.statusText}`, 'error');
          }
          return;
        }
        
        const data = await res.json();
        
        // æ‰¾åˆ°ç¬¬ä¸€ä¸ª JSON æ–‡ä»¶
        const fileEntry = Object.entries(data.files).find(([k, v]) => 
          v.language === 'JSON' || k.toLowerCase().endsWith('.json')
        );
        
        if (!fileEntry) {
          showLoginMsg('æœªæ‰¾åˆ°é…ç½®æ–‡ä»¶ï¼Œè¯·ç¡®ä¿åº”ç”¨ä¸­åŒ…å«æœ‰æ•ˆçš„é…ç½®æ•°æ®', 'error');
          return;
        }
        
        const fileName = fileEntry[0];
        const fileInfo = fileEntry[1];
        
        showLoginMsg('æ­£åœ¨åŠ è½½åº”ç”¨é…ç½®æ•°æ®...', 'info');
        
        // è·å–æ–‡ä»¶å†…å®¹
        let jsonText;
        if (fileInfo.content) {
          jsonText = fileInfo.content;
        } else {
          const rawRes = await fetch(fileInfo.raw_url, {
            method: 'GET',
            headers: headers,
            mode: 'cors'
          });
          
        if (!rawRes.ok) {
            showLoginMsg(`é…ç½®æ•°æ®åŠ è½½å¤±è´¥ï¼š${rawRes.status} ${rawRes.statusText}`, 'error');
          return;
          }
          
          jsonText = await rawRes.text();
        }
        
        // è§£æé…ç½®æ•°æ®
        try {
          // é¦–å…ˆå°è¯•ç®€å•çš„æ³¨é‡Šæ¸…ç†
          let simpleCleanJson = jsonText
            .replace(/\/\/.*$/gm, '')  // ç§»é™¤å•è¡Œæ³¨é‡Š
            .replace(/\/\*[\s\S]*?\*\//g, '')  // ç§»é™¤å¤šè¡Œæ³¨é‡Š
            .replace(/^\uFEFF/, '')  // ç§»é™¤BOM
            .trim();
          
          console.log('å°è¯•ç®€å•æ¸…ç†:', simpleCleanJson);
          
          try {
            // å…ˆå°è¯•ç®€å•æ¸…ç†çš„ç»“æœ
            currentJson = JSON.parse(simpleCleanJson);
            console.log('âœ… ç®€å•æ¸…ç†æˆåŠŸè§£æJSON');
          } catch (simpleError) {
            console.log('âŒ ç®€å•æ¸…ç†å¤±è´¥ï¼Œå°è¯•å®Œæ•´æ¸…ç†...');
            
            // å¦‚æœç®€å•æ¸…ç†å¤±è´¥ï¼Œä½¿ç”¨å®Œæ•´çš„æ¸…ç†æ–¹æ³•
            const cleanJsonText = removeJsonComments(jsonText);
            
            // æ·»åŠ è°ƒè¯•ä¿¡æ¯ï¼ˆå¼€å‘æ¨¡å¼ä¸‹å¯è§ï¼‰
            console.log('åŸå§‹JSONå†…å®¹:', jsonText);
            console.log('æ¸…ç†åJSONå†…å®¹:', cleanJsonText);
            console.log('å­—ç¬¦é•¿åº¦å¯¹æ¯”:', { 
              original: jsonText.length, 
              cleaned: cleanJsonText.length,
              diff: jsonText.length - cleanJsonText.length 
            });
            
            // è°ƒè¯•ï¼šæ˜¾ç¤ºä½ç½®74é™„è¿‘çš„å­—ç¬¦
            const problemPos = 74;
            const start = Math.max(0, problemPos - 10);
            const end = Math.min(cleanJsonText.length, problemPos + 10);
            console.log('ä½ç½®74é™„è¿‘çš„å­—ç¬¦:', {
              substring: cleanJsonText.substring(start, end),
              charCodes: Array.from(cleanJsonText.substring(start, end)).map((c, i) => ({
                pos: start + i,
                char: c,
                code: c.charCodeAt(0)
              }))
            });
            
            currentJson = JSON.parse(cleanJsonText);
          }
        } catch (e) {
          console.error('JSONè§£æå¤±è´¥è¯¦ç»†ä¿¡æ¯:', {
            error: e.message,
            position: e.message.match(/position (\d+)/)?.[1],
            originalLength: jsonText.length,
            cleanedLength: removeJsonComments(jsonText).length
          });
          
          // å°è¯•æä¾›æ›´å‹å¥½çš„é”™è¯¯æç¤º
          let friendlyMessage = 'é…ç½®æ•°æ®æ ¼å¼é”™è¯¯';
          if (e.message.includes('control character')) {
            friendlyMessage = 'é…ç½®æ•°æ®åŒ…å«ä¸æ”¯æŒçš„ç‰¹æ®Šå­—ç¬¦ï¼Œè¯·æ£€æŸ¥æ˜¯å¦æœ‰éšè—å­—ç¬¦æˆ–ç¼–ç é—®é¢˜';
          } else if (e.message.includes('Unexpected token')) {
            friendlyMessage = 'é…ç½®æ•°æ®è¯­æ³•é”™è¯¯ï¼Œè¯·æ£€æŸ¥JSONæ ¼å¼æ˜¯å¦æ­£ç¡®';
          } else if (e.message.includes('Unexpected end')) {
            friendlyMessage = 'é…ç½®æ•°æ®ä¸å®Œæ•´ï¼Œè¯·æ£€æŸ¥æ˜¯å¦ç¼ºå°‘é—­åˆæ‹¬å·æˆ–å¼•å·';
          }
          
          showLoginMsg(`${friendlyMessage}ï¼š${e.message}`, 'error');
          return;
        }
        
        // ä¿å­˜å…¨å±€çŠ¶æ€
        currentGistId = gistId;
        currentToken = token;
        currentFileName = fileName;
        currentFileInfo = fileInfo;
        
        // ä¿å­˜æ–‡ä»¶ä¿¡æ¯ï¼ˆç”¨äºåç»­æ“ä½œï¼‰
        
        // éªŒè¯é…ç½®æ ¼å¼å¹¶åˆå§‹åŒ–ç¼ºå¤±å­—æ®µ
        if (!currentJson.hasOwnProperty('version')) {
          currentJson.version = '1';
        }
        if (!currentJson.hasOwnProperty('isRedirectEnabled')) {
          currentJson.isRedirectEnabled = false;
        }
        if (!currentJson.hasOwnProperty('redirectUrl') || !currentJson.redirectUrl) {
          currentJson.redirectUrl = 'https://example.com';
        }
        
        // åŠ è½½é…ç½®åˆ°ç•Œé¢
        loadRedirectConfig();
        
        // æ›´æ–°App IDæ˜¾ç¤º
        const displayAppId = gistId.length > 8 ? gistId.substring(0, 8) + '...' : gistId;
        document.getElementById('currentAppId').textContent = displayAppId;
        
        // åˆ‡æ¢åˆ°ç®¡ç†æ§åˆ¶å°
        showPage('editPage');
        showEditMsg('ğŸ‰ APPåº”ç”¨è¿æ¥æˆåŠŸï¼Œé…ç½®æ•°æ®å·²åŠ è½½ï¼', 'success');
        
      } catch (e) {
        console.error('è¿æ¥APPåº”ç”¨æ—¶å‘ç”Ÿé”™è¯¯:', e);
        
        if (e.name === 'TypeError' && e.message.includes('fetch')) {
          showLoginMsg('ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œåº”ç”¨æ ‡è¯†ç¬¦', 'error');
        } else if (e.message.includes('CORS')) {
          showLoginMsg('ç½‘ç»œè¯·æ±‚è¢«é˜»æ­¢ï¼Œè¯·ç¨åå†è¯•', 'error');
        } else {
          showLoginMsg(`APPåº”ç”¨è¿æ¥å¼‚å¸¸ï¼š${e.message}`, 'error');
        }
      } finally {
        document.getElementById('connectBtn').disabled = false;
      }
    }

    // ä¿å­˜é…ç½®
    async function saveToGist() {
      if (!currentGistId || !currentToken || !currentFileName || !currentJson) {
        showEditMsg('ç¼ºå°‘å¿…è¦ä¿¡æ¯ï¼Œè¯·é‡æ–°è¿æ¥åˆ°APPåº”ç”¨', 'error');
        return;
      }
      
      // éªŒè¯å¿…å¡«å­—æ®µ
      if (!currentJson.redirectUrl || currentJson.redirectUrl.trim() === '') {
        showEditMsg('âŒ ç›®æ ‡è·³è½¬åœ°å€ä¸èƒ½ä¸ºç©ºï¼Œè¯·å¡«å†™æœ‰æ•ˆçš„ç½‘å€', 'error');
        // èšç„¦åˆ°URLè¾“å…¥æ¡†
        document.getElementById('redirectUrlInput').focus();
        return;
      }
      
      // éªŒè¯URLæ ¼å¼
      if (!validateUrl()) {
        showEditMsg('âŒ è¯·ä¿®æ­£ç›®æ ‡è·³è½¬åœ°å€çš„æ ¼å¼é”™è¯¯åå†ä¿å­˜', 'error');
        return;
      }
      
      document.getElementById('saveBtn').disabled = true;
      showEditMsg('æ­£åœ¨ä¿å­˜é…ç½®åˆ°APPåº”ç”¨...', 'info');
      
      try {
        const headers = {
          'Accept': 'application/vnd.github.v3+json',
          'User-Agent': 'App-Config-Manager/1.0',
          'Authorization': `Bearer ${currentToken}`,
          'Content-Type': 'application/json'
        };
        
        const requestBody = {
          files: {
            [currentFileName]: {
              content: JSON.stringify(currentJson, null, 2)
            }
          }
        };
        
        const res = await fetch(`https://api.github.com/gists/${currentGistId}`, {
          method: 'PATCH',
          headers: headers,
          mode: 'cors',
          body: JSON.stringify(requestBody)
        });
        
        if (!res.ok) {
          if (res.status === 404) {
            showEditMsg('åº”ç”¨èµ„æºä¸å­˜åœ¨æˆ–å·²è¢«åˆ é™¤', 'error');
          } else if (res.status === 403) {
            showEditMsg('æ²¡æœ‰ç¼–è¾‘æƒé™ï¼Œè¯·æ£€æŸ¥æ‚¨çš„è®¿é—®ä»¤ç‰Œæƒé™', 'error');
          } else if (res.status === 401) {
            showEditMsg('èº«ä»½éªŒè¯å¤±è´¥ï¼Œè®¿é—®ä»¤ç‰Œå¯èƒ½å·²è¿‡æœŸ', 'error');
          } else {
            showEditMsg(`ä¿å­˜å¤±è´¥ï¼š${res.status} ${res.statusText}`, 'error');
          }
          return;
        }
        
        const data = await res.json();
        showEditMsg('âœ¨ é…ç½®ä¿å­˜æˆåŠŸï¼æ•°æ®å·²åŒæ­¥åˆ°APPåº”ç”¨', 'success');
        
        // æ›´æ–°æ–‡ä»¶ä¿¡æ¯
        currentFileInfo = data.files[currentFileName];
        
      } catch (e) {
        console.error('ä¿å­˜é…ç½®æ—¶å‘ç”Ÿé”™è¯¯:', e);
        showEditMsg(`ä¿å­˜å¤±è´¥ï¼š${e.message}`, 'error');
      } finally {
        document.getElementById('saveBtn').disabled = false;
      }
    }

    // æ¶ˆæ¯æ˜¾ç¤ºç³»ç»Ÿ
    function showLoginMsg(msg, type = 'info') {
      const msgElement = document.getElementById('loginMsg');
      msgElement.textContent = msg;
      msgElement.className = `msg ${type}`;
      msgElement.style.display = 'block';
      
      // è‡ªåŠ¨éšè—æˆåŠŸæ¶ˆæ¯
      if (type === 'success') {
        setTimeout(() => {
          msgElement.style.display = 'none';
        }, 3000);
      }
    }

    function showEditMsg(msg, type = 'info') {
      const msgElement = document.getElementById('editMsg');
      msgElement.textContent = msg;
      msgElement.className = `msg ${type}`;
      msgElement.style.display = 'block';
      
      // è‡ªåŠ¨éšè—æˆåŠŸæ¶ˆæ¯
      if (type === 'success') {
        setTimeout(() => {
          msgElement.style.display = 'none';
        }, 5000);
      }
    }
  </script>
</body>
</html> 